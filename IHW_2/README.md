# Отчёт по лабораторной работе

## ФИО и группа

**Исполнитель:** Зенин Вадим Вадимович  
**Группа:** БПИ237

---

## Номер варианта и условие задачи

**Вариант:** 34

**Условие задачи:**  
Реализовать консольное приложение, в котором единый родительский процесс запускает заданное количество дочерних процессов. Каждый дочерний процесс моделирует поведение читателя в библиотеке, который может взять от 1 до 3 книг, читать их и возвращать по одной. Если нужной книги нет в наличии — читатель ожидает её. Возврат книги сопровождается уведомлением библиотекаря, который информирует всех ожидающих о её доступности.

---

## Сценарий решаемой задачи

Модель отражает взаимодействие читателей с библиотекой:

- **Родительский процесс** — инициализирует библиотеку, запускает читателей и библиотекаря.
- **Дочерние процессы** — реализуют поведение читателей:
  - Каждый читатель выбирает 1–3 случайные книги.
  - Если книга свободна — читатель берёт её и сразу начинает чтение.
  - Если книга занята — читатель ожидает уведомления от библиотекаря.
  - После чтения книга возвращается в библиотеку и становится доступной другим.
- **Процесс библиотекаря** — опрашивает очередь возвратов и уведомляет ожидающих читателей о доступных книгах.

---

# 4-5
## Схема взаимодействия процессов

Для реализации взаимодействия между процессами выбрана схема **a**:

- **Именованные POSIX семафоры** — используются для синхронизации доступа к книгам и очереди возвратов.
- **Разделяемая память (POSIX `shm_open`)** — хранит:
  - массив доступных книг;
  - очередь возвратов;
  - указатели `head` и `tail` для кольцевой очереди.

Объекты синхронизации:

- `sem_book_mutex[i]` — семафор для каждой книги, обеспечивает взаимное исключение при доступе к конкретной книге;
- `sem_books[i]` — семафоры ожидания, на которые подписываются читатели, если книга занята;
- `sem_notify` — семафор-уведомитель от читателя библиотекарю при возврате книги;
- `sem_mutex_queue` — защита кольцевой очереди возвратов.

---

## Обработка завершения

Реализованы два варианта завершения:

1. **Нормальное завершение**: после завершения всех дочерних процессов происходит очистка ресурсов.
2. **Завершение по сигналу (например, Ctrl+C)**:
   - Обрабатывается сигнал `SIGINT`.
   - Останавливаются все процессы.
   - Удаляются все созданные семафоры и разделяемая память.

---

## Очистка ресурсов

В функции `cleanup_and_exit()` предусмотрено:

- Удаление сегмента разделяемой памяти через `shm_unlink`.
- Освобождение всех POSIX семафоров через `sem_destroy`.
- Завершение процесса с кодом возврата.

---

## Пример запуска и результаты работы

Пример вывода:
```
[Читатель 1] хочет прочитать 1 книг(-и)
[Читатель 1] взял книгу 1
[Читатель 1] читает книгу 1 2 дней
[Читатель 2] хочет прочитать 2 книг(-и)
[Читатель 2] взял книгу 2
[Читатель 2] читает книгу 2 2 дней
[Читатель 2] вернул книгу 2
[Читатель 1] вернул книгу 1
[Библиотекарь] уведомляю читателя о книге 2
[Библиотекарь] уведомляю читателя о книге 1
[Читатель 2] взял книгу 1
[Читатель 2] читает книгу 1 1 дней
[Читатель 2] вернул книгу 1
```

---

# 6-5
##