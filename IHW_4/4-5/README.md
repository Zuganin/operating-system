# Система шифрования "Пляшущие человечки"

## Описание задачи
Реализация клиент-серверного приложения для шифрования текста с использованием шифра "пляшущие человечки", где каждая буква заменяется ASCII кодом. Система использует парадигму портфеля задач для распределенного шифрования.

### Сценарий работы:
1. **Сервер** читает исходный текст из файла и создает портфель задач
2. **Клиенты-шифровальщики** получают фрагменты текста, шифруют их ASCII кодами
3. **Сервер** собирает зашифрованные фрагменты в правильном порядке
4. **Результат**: исходный и полностью зашифрованный текст

## Особенности реализации
- ✅ **Портфель задач**: размер задачи = `размер_файла / (количество_клиентов * 3)`
- ✅ **Асинхронная работа**: клиенты работают с случайными задержками
- ✅ **Упорядочение фрагментов**: сервер корректно собирает результаты по позициям
- ✅ **Шифрование**: каждый символ → ASCII код + пробел
- ✅ **Сетевые параметры**: IP и порт задаются через командную строку
- ✅ **Обработка SIGINT**: корректное завершение с освобождением ресурсов

## Компиляция
```bash
gcc -Wall -Wextra -std=c99 -pthread -o server server.c
gcc -Wall -Wextra -std=c99 -o client client.c
```

## Использование

### Запуск сервера
```bash
./server <количество_клиентов> <путь_к_файлу> [IP] [порт]
```

Примеры:
```bash
./server 2 secret_message.txt                      # Слушать на всех интерфейсах, порт 8080
./server 3 document.txt 192.168.1.100              # IP: 192.168.1.100, порт 8080
./server 3 document.txt 192.168.1.100 9000         # IP: 192.168.1.100, порт 9000
./server 2 text.txt 9000                           # Если введен только номер, то это порт
```

### Запуск клиента
```bash
./client [IP_сервера] [порт]
```

Примеры:
```bash
./client                              # localhost:8080 по умолчанию
./client 192.168.1.100                # указанный IP, порт 8080
./client 192.168.1.100 9000           # указанный IP и порт
```

## Пример работы

### 1. Локальное тестирование
```bash
# Терминал 1: Запуск сервера
./server 2 secret_message.txt

# Терминал 2-3: Запуск клиентов
./client
./client
```

### 2. Сетевое тестирование
```bash
# На сервере (привязать к конкретному IP):
./server 3 document.txt 192.168.1.100 9000

# Или слушать на всех интерфейсах:
./server 3 document.txt 9000

# На клиентских машинах:
./client 192.168.1.100 9000
./client 192.168.1.100 9000
./client 192.168.1.100 9000
```

## ✅ Исправления и улучшения

### Устранённые проблемы:
1. **Проблема подключения:** Клиенты теперь могут подключаться к серверу, даже если запущены до него (до 10 попыток переподключения)
2. **Проблема завершения:** Клиенты автоматически завершаются после окончания работы сервера
3. **Улучшенная стабильность:** Устранены предупреждения компилятора и утечки памяти

Подробное описание исправлений см. в файле `FIXES.md`.

### Автоматизированное тестирование:
```bash
# Комплексный тест всех исправлений
./comprehensive_test.sh

# Демонстрационный скрипт
./demo.sh
```

## Вывод программы

### Сервер показывает:
```
=== ПЛЯШУЩИЕ ЧЕЛОВЕЧКИ - ШИФРОВАЛЬНАЯ СИСТЕМА ===
Исходный текст: Hello World! This is a secret message from Professor Moriarty to all the members of his criminal organization. 
AHAHAHAHHAHAHAHAHAHHAHAHAHHAHAHAHAA...
Создан портфель из 6 задач по 156 символов каждая
Сервер запущен на 127.0.0.1:8080
Ожидание запросов задач от клиентов...
Получен запрос от клиента: GET_TASK
Новый клиент подключен: 127.0.0.1:51667 (всего клиентов: 1)
Отправляем задачу клиенту (позиция 0): Hello World! This is a secret message from Professor Moriarty to all the members of his criminal organization. 
Получен запрос от клиента: SUBMIT_RESULT:0:72 101 108 108 111 32 87 111 114 108 100 33 32 84 104 105 115 32 105 115 32 97 32 115 101 99 114 101 116 32 109 1
=== ИТОГОВЫЙ ЗАШИФРОВАННЫЙ ТЕКСТ ===
72 101 108 108 111 32 87 111 114 108 100 33 32 84 104 105 115 32 105 115 32 97 32 115 101 99 114 101 116 32 109 101 115 115 97 103 101 32 102 114 111 109 32 80 114 111 102 101 115 115 111 114 32 77 111 114 ...
```

### Клиент показывает:
```
=== КЛИЕНТ-ШИФРОВАЛЬЩИК ПЛЯШУЩИХ ЧЕЛОВЕЧКОВ ===
Подключение к серверу 127.0.0.1:8080

Получена задача 1 (позиция 0): Hello World! This is a secret message from Professor Moriarty to all the members of his criminal organization. 
AHAHAHAHHAHAHAHAHAHHAHAHAHHAHAHAHAAHAHAHAHHA
Шифрование фрагмента...
Зашифрованный фрагмент: 72 101 108 108 111 32 87 111 114 108 100 33 32 84 104 105 115 32 105 115 32 97 32 115 101 99 114 101 116 32 109 101 115 115 97 103 101 32 102 114 111 109 32 80 114 111 102 101 115 115 111 114 32 77 111 114 105 97 114 116 121 32 116 111 32 97 108 108 32 116 104 101 32 109 101 109 98 101 114 115 32 111 102 32 104 105 115 32 99 114 105 109 105 110 97 108 32 111 114 103 97 110 105 122 97 116 105 111 110 46 32 10 65 72 65 72 65 72 65 72 72 65 72 65 72 65 72 65 72 65 72 72 65 72 65 72 65 72 72 65 72 65 72 65 72 65 65 72 65 72 65 72 65 72 72 65 
Результат отправлен серверу
```

## Завершение работы
- **Ctrl+C**: корректное завершение с освобождением памяти
- **Автоматическое**: после обработки всех фрагментов
- **Сетевая устойчивость**: обработка разрывов соединения

